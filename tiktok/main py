from telegram.ext import Updater, CommandHandler, MessageHandler, Filters
import requests

TOKEN = '8029070620:AAF9ISFXzaeZrRKZGthHOVhALD6AWWBMBeM'

def start(update, context):
    update.message.reply_text("Ù‡Ù„Ø§ Ø­Ø¨! ğŸŒ¸\nØ£Ø±Ø³Ù„ Ø±Ø§Ø¨Ø· ÙÙŠØ¯ÙŠÙˆ TikTok ÙˆØ±Ø§Ø­ Ø£Ø±Ø¬Ø¹ Ù„Ùƒ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ø¯ÙˆÙ† Ø¹Ù„Ø§Ù…Ø© Ù…Ø§Ø¦ÙŠØ© ğŸ’ƒ")

def get_tiktok_video(url):
    try:
        api = "https://tikwm.com/api/"
        params = {'url': url}
        headers = {
            "User-Agent": "Mozilla/5.0"
        }
        res = requests.get(api, params=params, headers=headers)
        data = res.json()
        if data.get("data") and data["data"].get("play"):
            return data["data"]["play"]
        else:
            return None
    except Exception as e:
        print("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ:", e)
        return None

def handle_message(update, context):
    url = update.message.text
    update.message.reply_text("Ø«ÙˆØ§Ù†ÙŠ Ø­Ø¨ÙŠØŒ Ø¯Ø§ Ø£Ø­Ù…Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ğŸ¬...")

    video_url = get_tiktok_video(url)
    if video_url:
        update.message.reply_video(video_url)
    else:
        update.message.reply_text("Ù…Ø§ Ù‚Ø¯Ø±Øª Ø£Ø¬ÙŠØ¨ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ğŸ˜¢ ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· Ø£Ùˆ Ø¬Ø±Ø¨ Ù…Ø±Ù‡ Ø«Ø§Ù†ÙŠØ©.")

def main():
    updater = Updater(TOKEN, use_context=True)
    dp = updater.dispatcher

    dp.add_handler(CommandHandler("start", start))
    dp.add_handler(MessageHandler(Filters.text & ~Filters.command, handle_message))

    updater.start_polling()
    updater.idle()

if __name__ == '__main__':
    main()